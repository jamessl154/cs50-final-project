{% extends "layout.html" %}

{% block title %}{{ portfolio_name }}{% endblock %}
{% block main %}
<h1 class="display-1">{{ portfolio_name }}</h1>
<br>
<h3>Net Profit at today's prices:</h3>
<br>
{% if net_overall < 0 %}
    <div>
        <span class="inner fa fa-caret-down fa-2x"></span>
        &nbsp&nbsp<h2 class=" inner loss_title">{{ net_overall | usd }}</h2>
    </div>
    <br>
    <div>
        <span class="inner fa fa-caret-down fa-2x"></span>
        &nbsp&nbsp&nbsp<h2 class="inner loss_title">{{ net_overallpercent }}%</h2>
    </div>
{% else %}
    <div>
        <span class="inner fa fa-caret-up fa-2x"></span>
        &nbsp&nbsp<h2 class=" inner gain_title">{{ net_overall | usd }}</h2>
    </div>
    <br>
    <div>
        <span class="inner fa fa-caret-up fa-2x"></span>
        &nbsp&nbsp&nbsp<h2 class="inner gain_title">{{ net_overallpercent }}%</h2>
    </div>
{% endif %}
<br>
<div id="full_bar">
    <!--
        Problems deciding how the divs are scaled

        Since we are scaling off the largest gain/loss in a users portfolio the parent
        element always appears the same size on the page which could be problematic

        Using absolute sizing, extreme gains/losses could look odd/not visible to the user
        
        The largest gain or loss is arguably the most important detail to 
        the user in tracking their relative portfolio progress

        For each element in x: if gain key was assigned, group with gain elements, style color green
        else style red for loss. Create new attribute data-id, manipulate a string using slicing/concatenation for use in CSS
        All dates will be 8 digit strings at the end of unique_id so the rest of the string is the symbol
        cast i['contribution'] as a string to concatenate
    -->
    {% for i in x %}
        {% if i["contribution"] > 0 %}
            <div class="bar gain_element" data-link="{{ url_for('share', unique_id=i['unique_id'], portfolio_name=portfolio_name) }}"
             data-id="{{ (i['unique_id'])[:-8] + ' +' + str(i['contribution']) + '%' }}" style='flex: {{ i["flex"] }};'></div>
        {% else %}
            <div class="bar loss_element" data-link="{{ url_for('share', unique_id=i['unique_id'], portfolio_name=portfolio_name) }}"
             data-id="{{ (i['unique_id'])[:-8] + ' ' + str(i['contribution']) + '%' }}" style='flex: {{ i["flex"] }};'></div>
        {% endif %}
    {% endfor %}
</div>
<br>
<br>
<h3>Portfolio value at today's prices:</h3>
<br>
<h2>{{ current_overall | usd }}</h2>
<br>
<h3>Portfolio value at time of purchase:</h3>
<br>
<h2>{{ purchase_overall | usd }}</h2>
<br>
<br>
<!-- Button trigger modal -->
<button type="button" class="btn btn-outline-primary" data-toggle="modal" data-target="#HowtoModal">
  How to Use
</button>

<!-- https://getbootstrap.com/docs/4.2/components/modal/ -->
<div class="modal fade" id="HowtoModal" tabindex="-1" role="dialog" aria-labelledby="HowtoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h1 class="display-4 modal-title" id="HowtoModalLabel">How to use:</h1>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body">
            <br>
            <p>
              <span id="badgemodal" class="badge badge-secondary">Mouseover</span>&nbsp
              the bar elements to show the contribution of each purchase
              towards net profit as a percentage.
            </p>
            <br>
            <p>
              <span id="badgemodal" class="badge badge-secondary">Click</span>&nbsp
              the bar elements for an in-depth breakdown of that purchase,
              including date purchased, dollar value gained and performance against itself.
            </p>
            <br>
            <p>
                <span id="badgemodal" class="badge badge-secondary">Hint</span>&nbsp
                Duplicates are shown if you bought a share at different prices.
                This is done intentionally so you can compare performance between those purchases.
            </p>
            <br>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
          </div>
      </div>
  </div>
</div>
<br>
<br>
<a class="btn btn-primary" href="/">Index</a>

<script src=/static/portfolio.js></script>

{% endblock %}